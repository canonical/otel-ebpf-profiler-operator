# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

# This file configures Charmcraft.
# See https://juju.is/docs/sdk/charmcraft-config for guidance.

name: otel-ebpf-profiler
type: charm

summary: A whole-system, cross-language profiler for Linux via eBPF.
description: |
  A whole-system, cross-language profiler for Linux via eBPF.  

links:
  # documentation: https://discourse.charmhub.io/
  website: https://charmhub.io/otel-ebpf-profiler
  source: https://github.com/canonical/otel-ebpf-profiler-operator
  issues: https://github.com/canonical/otel-ebpf-profiler-operator/issues

assumes:
  - juju >= 3.6

platforms:
  ubuntu@24.04:amd64:
  ubuntu@24.04:arm64:

requires:
  profiling:
    interface: profiling
    optional: true
    description: Require a profiling backend (or an otel collector) to send the gathered profiles to.
  receive-ca-cert:
    interface: certificate_transfer
    optional: true
    description: |
      Require CA certificates from a certificates provider charm. 
      This will enable the otel-ebpf-profiler-operator to push profiles over TLS to any charm exposing secured ingestion endpoints.

provides: 
  cos-agent:
    interface: cos_agent
    limit: 1
    optional: true
    description: Allow an OpenTelemetry Collector or Grafana Agent to scrape or receive forwarded self-monitoring data.

parts:
  charm:
    source: .
    plugin: uv
    build-packages: [git]
    build-snaps: [astral-uv]
    override-build: |
      craftctl default
      git describe --always > $CRAFT_PART_INSTALL/version

